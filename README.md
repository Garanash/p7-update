# Скрипт обновления остатков

Скрипт для автоматического обновления остатков в файле "Сборка Москва.xlsx" из файла, полученного по почте.

## Функционал

1. Подключается к почте Gmail и ищет последнее письмо с Excel вложением (файл "для бота")
2. Скачивает файл из почты
3. Обновляет лист "остатки" в файле "Сборка Москва.xlsx"
4. На всех листах, где есть столбцы "Номер по каталогу" и "Номер по каталогу АГБ", обновляет столбец "Остатки" на основе данных из файла бота

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Настройка Gmail

**ВАЖНО**: Для работы с Gmail через IMAP может потребоваться пароль приложения вместо обычного пароля.

1. Включите двухфакторную аутентификацию в вашем Google аккаунте
2. Создайте пароль приложения:
   - Перейдите на https://myaccount.google.com/apppasswords
   - Выберите "Почта" и "Другое устройство"
   - Скопируйте сгенерированный пароль
   - Используйте этот пароль в скрипте вместо обычного пароля

## Использование

### Запуск с почтой (основной режим):
```bash
python update_ostanki.py
```

### Тестирование с локальным файлом:
```bash
python update_ostanki.py "для бота (XLSX).xlsx"
```

## Структура файлов

- `Сборка Москва.xlsx` - основной файл с данными
- `для бота (XLSX).xlsx` - файл с остатками (скачивается из почты или используется локально)

## Формат данных

Скрипт ищет в файле бота:
- Столбец с номерами каталога (например, "Номенклатура" или "Номер по каталогу")
- Столбец с остатками (например, "Количество")

В основном файле скрипт ищет:
- Столбцы "Номер по каталогу" и "Номер по каталогу АГБ"
- Столбец "Остатки" (создается автоматически, если отсутствует)

## Примечания

- Скрипт суммирует остатки для одинаковых номеров каталога
- Если для номера каталога нет остатков, ставится 0
- Скрипт обновляет все листы, кроме листа "остатки"

